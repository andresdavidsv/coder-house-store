<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <title>Products</title>
</head>

<body class="container">
  {{> header}}

  {{{body}}}

  {{> footer}}
  <script src="/socket.io/socket.io.js"></script>
  <script src="/static/index.js"></script>
  <script src="/static/chat.js"></script>
  <script>
    const formProduct = document.querySelector('#productForm');
    const productTitle = document.querySelector('#productTitle');
    const productPrice = document.querySelector('#productPrice');
    const productThumbnail = document.querySelector('#productThumbnail');
    const contentTable = document.querySelector('#contentTable');

    formProduct.addEventListener('submit', (e) => {
      e.preventDefault();
      const title = productTitle.value;
      const price = productPrice.value;
      const thumbnail = productThumbnail.value;

      re = /^http.*.(jpeg|jpg|gif|png)$/;

      if (title !== "" && price !== "" && thumbnail !== "" && re.exec(thumbnail)) {
        socket.emit('products-to-server', {
          title: title,
          price: price,
          thumbnail: thumbnail
        })
      }
    })

    socket.on('products-from-server', (data) => {
      if (data.status !== 'error' && data.products.length > 0 ) {
        let productsPrint = data.products.map(product => {
          return `
          <tr>
            <th scope="row"> ${product.id} </th>
            <td> ${product.title} </td>
            <td> ${product.price} </td>
            <td><img src=${product.thumbnail} alt=${product.title} border="3" height="100" width="100" /></td>
          </tr>
          ` }
        ).join('');
        contentTable.innerHTML = productsPrint;
      } else if (!data.products.length > 0) {
        contentTable.innerHTML = `
        <tr>
          <td colspan="4">NO FOUND PRODUCT </td>
        </tr>`
      } else {
        contentTable.innerHTML = `
        <tr>
          <td colspan="4">${data.message}</td>
        </tr>`
      }
    })
  </script>
</body>
</html>
